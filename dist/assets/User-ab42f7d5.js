import{y as I,z as J,d as O,x as E,w as W,A as Q,C as X,E as Y,r as f,v as Z,_ as ee,b as e,l as te,n as ae,g as se,F as G,s as ne,i as re,a as D,j as b,B as U,T as $,o as w,p as ie,G as oe,H as le,I as ce,J as ue,K as de,P as _e,q as me,L as he,M as fe,k as pe,N as ke,D as be,O as ge}from"./index-a633cc79.js";import{F as z,T,B as S,c as L,a as j,S as ye,b as A}from"./formik.esm-b87222a4.js";import{s as ve,D as M,a as V,b as q,S as xe,C as Ce,M as Ue,c as De}from"./DataGrid-85bca8c6.js";import{G as Se}from"./GridToolbar-5de01d47.js";import"./index-4d501b15.js";const Be=["component","direction","spacing","divider","children","className","useFlexGap"],we=I(),Te=ve("div",{name:"MuiStack",slot:"Root",overridesResolver:(n,o)=>o.root});function $e(n){return J({props:n,name:"MuiStack",defaultTheme:we})}function je(n,o){const r=f.Children.toArray(n).filter(Boolean);return r.reduce((d,g,l)=>(d.push(g),l<r.length-1&&d.push(f.cloneElement(o,{key:`separator-${l}`})),d),[])}const Fe=n=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[n],Re=({ownerState:n,theme:o})=>{let r=O({display:"flex",flexDirection:"column"},E({theme:o},W({values:n.direction,breakpoints:o.breakpoints.values}),d=>({flexDirection:d})));if(n.spacing){const d=Q(o),g=Object.keys(o.breakpoints.values).reduce((_,a)=>((typeof n.spacing=="object"&&n.spacing[a]!=null||typeof n.direction=="object"&&n.direction[a]!=null)&&(_[a]=!0),_),{}),l=W({values:n.direction,base:g}),p=W({values:n.spacing,base:g});typeof l=="object"&&Object.keys(l).forEach((_,a,y)=>{if(!l[_]){const m=a>0?l[y[a-1]]:"column";l[_]=m}}),r=X(r,E({theme:o},p,(_,a)=>n.useFlexGap?{gap:G(d,_)}:{"& > :not(style) + :not(style)":{margin:0,[`margin${Fe(a?l[a]:n.direction)}`]:G(d,_)}}))}return r=Y(o.breakpoints,r),r};function Pe(n={}){const{createStyledComponent:o=Te,useThemeProps:r=$e,componentName:d="MuiStack"}=n,g=()=>ae({root:["root"]},_=>se(d,_),{}),l=o(Re);return f.forwardRef(function(_,a){const y=r(_),v=Z(y),{component:m="div",direction:t="column",spacing:c=0,divider:k,children:s,className:i,useFlexGap:h=!1}=v,x=ee(v,Be),B={direction:t,spacing:c,useFlexGap:h},F=g();return e(l,O({as:m,ownerState:B,ref:a,className:te(F.root,i)},x,{children:k?je(s,k):s}))})}const Ne=Pe({createStyledComponent:ne("div",{name:"MuiStack",slot:"Root",overridesResolver:(n,o)=>o.root}),useThemeProps:n=>re({props:n,name:"MuiStack"})}),We=Ne,Me=L().shape({user_code:j().required("กรุณากรอกรหัสผู้ใช้งาน"),user_firstname_th:j().required("กรุณากรอกชื่อไทยผู้ใช้งาน"),user_lastname_th:j().required("กรุณากรอกนามสกุลไทยผู้ใช้งาน"),user_firstname_en:j().required("กรุณากรอกชื่ออังกฤษผู้ใช้งาน"),user_lastname_en:j().required("กรุณากรอกนามสกุลอังกฤษผู้ใช้งาน")});function Ve({open:n,handleDialogClose:o,userId:r=null}){const[d,g]=f.useState({user_code:"",user_firstname_th:"",user_lastname_th:"",user_firstname_en:"",user_lastname_en:""}),[l,p]=f.useState(null);f.useEffect(()=>{a()},[n,o]);const C=()=>{_(),o()},_=()=>{g({user_code:"",user_firstname_th:"",user_lastname_th:"",user_firstname_en:"",user_lastname_en:""})},a=async()=>{if(r){const t=await D.get(`/users/get-user/${r}`);t.status==200&&(g({user_code:t.data.user_code,user_firstname_th:t.data.user_firstname_th,user_lastname_th:t.data.user_lastname_th,user_firstname_en:t.data.user_firstname_en,user_lastname_en:t.data.user_lastname_en}),p(t.data.user_status))}},y=async t=>{if(r){const c=await D.put(`/users/update-user/${r}`,{user_code:t.user_code,user_firstname_th:t.user_firstname_th,user_lastname_th:t.user_lastname_th,user_firstname_en:t.user_firstname_en,user_lastname_en:t.user_lastname_en});c.status==201&&w(c.data).then(()=>{C()})}else{const c=await D.post("/users/create-user",{user_code:t.user_code,user_firstname_th:t.user_firstname_th,user_lastname_th:t.user_lastname_th,user_firstname_en:t.user_firstname_en,user_lastname_en:t.user_lastname_en});c.status==201&&w(c.data).then(()=>{C()})}},v=t=>{t.target.checked?p(1):p(0),m()},m=()=>{r&&D.put(`/users/change-user-status/${r}`,{}).then(t=>{t.status==200&&w(t.data)})};return b(M,{open:n,onClose:C,fullWidth:!0,children:[e(V,{children:r?"แก้ไขผู้ใช้งาน":"เพิ่มผู้ใช้งาน"}),b(q,{children:[b(U,{display:"flex",gap:1.5,alignItems:"center",children:[e($,{variant:"body1",children:"สถานะผู้ใช้งาน:"}),e(xe,{checked:l==1,onChange:v,inputProps:{"aria-label":"สถานะผู้ใช้งาน"},disabled:!r,color:l==1?"success":"primary"}),r&&e($,{variant:"body1",style:{color:l==1?"green":"gray"},children:l==1?"อนุมัติแล้ว":"ยังไม่อนุมัติ"})]}),e(z,{onSubmit:y,initialValues:d,validationSchema:Me,enableReinitialize:!0,children:({values:t,errors:c,touched:k,handleBlur:s,handleChange:i,handleSubmit:h,isValid:x,dirty:B})=>e("form",{onSubmit:h,style:{width:"100%",marginTop:"1rem"},children:b(U,{display:"flex",flexDirection:"column",gap:"1rem",sx:{width:"100%"},children:[e(T,{fullWidth:!0,variant:"outlined",type:"text",label:"รหัสผู้ใช้งาน",onBlur:s,onChange:i,value:t.user_code,name:"user_code",error:!!k.user_code&&!!c.user_code,helperText:k.user_code&&c.user_code}),e(T,{fullWidth:!0,variant:"outlined",type:"text",label:"ชื่อ(ไทย)",onBlur:s,onChange:i,value:t.user_firstname_th,name:"user_firstname_th",error:!!k.user_firstname_th&&!!c.user_firstname_th,helperText:k.user_firstname_th&&c.user_firstname_th}),e(T,{fullWidth:!0,variant:"outlined",type:"text",label:"นามสกุล(ไทย)",onBlur:s,onChange:i,value:t.user_lastname_th,name:"user_lastname_th",error:!!k.user_lastname_th&&!!c.user_lastname_th,helperText:k.user_lastname_th&&c.user_lastname_th}),e(T,{fullWidth:!0,variant:"outlined",type:"text",label:"ชื่อ(อังกฤษ)",onBlur:s,onChange:i,value:t.user_firstname_en,name:"user_firstname_en",error:!!k.user_firstname_en&&!!c.user_firstname_en,helperText:k.user_firstname_en&&c.user_firstname_en}),e(T,{fullWidth:!0,variant:"outlined",type:"text",label:"นามสกุล(อังกฤษ)",onBlur:s,onChange:i,value:t.user_lastname_en,name:"user_lastname_en",error:!!k.user_lastname_en&&!!c.user_lastname_en,helperText:k.user_lastname_en&&c.user_lastname_en}),b(U,{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:2,children:[e(S,{type:"submit",color:"success",variant:"contained",disabled:!x||!B,children:"บันทัก"}),e(S,{color:"inherit",variant:"contained",onClick:C,children:"ยกเลิก"})]})]})})})]})]})}function qe({open:n,handleDialogClose:o,userId:r=null}){const[d,g]=f.useState([]),l=ie();f.useEffect(()=>{p()},[n,o]);const p=async()=>{if(r){const a=await D.get(`/users/get-user-hospital/${r}`);if(a.status==200){const y=a.data.user_hospital,v=a.data.hospitals;let m=[];for(let t of v)m.push({hospital_id:t.hospital_id,hospital_name_th:t.hospital_name_th,hospital_name_en:t.hospital_name_en,isWorking:!1});for(let t of m)for(let c of y)t.hospital_id==c.hospital_id&&(t.isWorking=!0);g(m)}}},C=()=>{r=null,o(),l("/users")},_=(a,y)=>{a==!0?oe().then(v=>{v.isConfirmed&&D.post(`/users/add-remove-user-hospital/${r}/${y}`,{isWorking:a}).then(m=>{m.status==200&&w(m.data).then(()=>{p()})})}):le().then(v=>{v.isConfirmed&&D.post(`/users/add-remove-user-hospital/${r}/${y}`,{isWorking:a}).then(m=>{m.status==200&&w(m.data).then(()=>{p()})})})};return b(M,{open:n,onClose:C,fullWidth:!0,children:[e(V,{children:"โรงพยาบาลที่ผู้ใช้งานบรรจุ"}),e(q,{children:e(U,{display:"flex",flexDirection:"column",p:1.5,gap:1,justifyContent:"center",children:d==null?void 0:d.map((a,y)=>e(Ce,{label:`${a.hospital_name_th} | ${a.hospital_name_en}`,variant:a.isWorking?"filled":"outlined",color:"primary",sx:{cursor:"pointer"},onClick:()=>_(!a.isWorking,a.hospital_id)},y))})})]})}var H={},He=ue;Object.defineProperty(H,"__esModule",{value:!0});var K=H.default=void 0,Ee=He(ce()),Ge=de,Ae=(0,Ee.default)((0,Ge.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete");K=H.default=Ae;const Oe=L().shape({bank_id:A().required("กรุณาเลือกธนาคาร"),user_bank_code:A().min(10,"กรุณากรอกอย่างน้อย 10 ตัว").required("กรุณากรอกเลขบัญชีธนาคาร"),user_bank_name:j().required("กรุณากรอกชื่อบัญชีธนาคาร")}),ze={bank_id:1,user_bank_code:"",user_bank_name:""};function Le({open:n,handleDialogClose:o,userId:r=null}){const[d,g]=f.useState([]),[l,p]=f.useState(!1),[C,_]=f.useState([]);f.useEffect(()=>{a(),y()},[n,o]);const a=async()=>{const s=await D.get(`/users/get-user-bank-accounts/${r}`);if(s.status==200){let i=s.data,h=[];for(let x of i)h.push({user_bank_id:x.user_bank_id,user_bank_code:x.user_bank_code,user_bank_name:x.user_bank_name,bank_name_en:x.bank.bank_name_en,bank_name_th:x.bank.bank_name_th});g(h)}},y=async()=>{const s=await D.get("/banks/get-banks");s.status==200&&_(s.data)},v=s=>{const i=s.which||s.keyCode;i===8||i===46||(i<48||i>57)&&s.preventDefault()},m=()=>{r=null,o()},t=s=>{p(!s)},c=s=>{D.post(`/users/create-user-bank-account/${r}`,{bank_id:s.bank_id,user_bank_code:s.user_bank_code,user_bank_name:s.user_bank_name}).then(i=>{i.status==201&&w(i.data).then(()=>{a(),p(!1)})})},k=s=>{fe().then(i=>{i.isConfirmed&&D.delete(`/users/remove-user-bank-account/${s}`).then(h=>{h.status==200&&(w(h.data),a())})})};return b(M,{open:n,onClose:m,fullWidth:!0,children:[e(V,{children:"สมุดบัญชีผู้ใช้งาน"}),e(q,{children:b(U,{width:"100%",display:"flex",flexDirection:"column",gap:2,justifyContent:"center",children:[l==!1&&e(U,{width:"50%",children:e(S,{variant:"contained",color:"success",onClick:()=>t(l),children:"เพิ่มสมุดบัญชีของผู้ใช้"})}),l&&e(U,{children:e(z,{onSubmit:c,initialValues:ze,validationSchema:Oe,enableReinitialize:!0,children:({values:s,errors:i,touched:h,handleBlur:x,handleChange:B,handleSubmit:F,isValid:N,dirty:u})=>e("form",{onSubmit:F,style:{width:"100%",marginTop:"1rem"},children:b(U,{display:"flex",flexDirection:"column",gap:"1rem",sx:{width:"100%"},children:[e(ye,{fullWidth:!0,variant:"outlined",label:"ธนาคาร",onBlur:x,onChange:B,value:s.bank_id,name:"bank_id",error:!!h.bank_id&&!!i.bank_id,children:C.map((R,P)=>b(Ue,{value:R.bank_id,children:[R.bank_name_th," ",R.bank_name_en]},P))}),e(T,{fullWidth:!0,variant:"outlined",type:"text",onKeyDown:v,label:"เลขบัญชี",onBlur:x,onChange:B,value:s.user_bank_code,name:"user_bank_code",error:!!h.user_bank_code&&!!i.user_bank_code,helperText:h.user_bank_code&&i.user_bank_code}),e(T,{fullWidth:!0,variant:"outlined",type:"text",label:"ชื่อบัญชี",onBlur:x,onChange:B,value:s.user_bank_name,name:"user_bank_name",error:!!h.user_bank_name&&!!i.user_bank_name,helperText:h.user_bank_name&&i.user_bank_name}),b(U,{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:2,children:[e(S,{type:"submit",color:"success",variant:"contained",disabled:!N||!u,children:"เพิ่มสมุดบัญชี"}),e(S,{color:"inherit",variant:"contained",onClick:()=>p(!1),children:"ยกเลิก"})]})]})})})}),e(We,{direction:"column",spacing:1,children:d==null?void 0:d.map((s,i)=>b(_e,{elevation:2,sx:{display:"flex",flexDirection:"column",p:2,position:"relative"},children:[e(me,{title:"ลบบัญชีนี้",sx:{position:"absolute",top:1,right:1},children:e(he,{onClick:()=>k(s.user_bank_id),children:e(K,{})})}),b($,{children:["ธนาคาร: ",s.bank_name_th," ",s.bank_name_en]}),b($,{children:["เลขบัญชี: ",s.user_bank_code]}),b($,{children:["ชื่อบัญชี: ",s.user_bank_name]})]},i))})]})})]})}function Ye(){pe();const[n,o]=f.useState(null),[r,d]=f.useState(!1),[g,l]=f.useState(!1),[p,C]=f.useState(!1),[_,a]=f.useState(null),y=[{field:"user_code",headerName:"รหัสผู้ใช้งาน",width:150},{field:"user_firstname_th",headerName:"ชื่อ(ไทย)",flex:1},{field:"user_lastname_th",headerName:"นามสกุล(ไทย)",flex:1},{field:"user_firstname_en",headerName:"ชื่อ(อังกฤษ)",flex:1},{field:"user_lastname_en",headerName:"นามสกุล(อังกฤษ)",flex:1},{field:"created_at",headerName:"เข้าร่วมเมื่อ",width:150,valueFormatter:u=>new Date(u.value).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})},{field:"user_status",headerName:"สถานะ",width:150,renderCell:u=>e(U,{width:"60%",gap:1,m:"0 auto",borderRadius:1.5,display:"flex",justifyContent:"center",sx:{backgroundColor:u.value==1?"green":"gray"},children:e($,{color:"white",children:u.value==1?"อนุมัติแล้ว":"ยังไม่อนุมัติ"})})},{field:"user_id",headerName:"จัดการ",flex:1.5,renderCell:u=>b(U,{display:"flex",flexDirection:"row",gap:.5,justifyContent:"center",alignItems:"center",width:"100%",children:[e(S,{color:"warning",variant:"contained",onClick:()=>x(u.value),children:"แก้ไข"}),e(S,{color:"secondary",variant:"contained",onClick:()=>F(u.value),children:"โรงพยาบาล"}),e(S,{color:"success",variant:"contained",onClick:()=>N(u.value),children:"สมุดบัญชี"}),e(S,{color:"error",variant:"contained",onClick:()=>B(u.value),children:"ลบ"})]})}],[v]=ke();f.useEffect(()=>{h(),v.get("user_id")&&(a(Number(v.get("user_id"))),c())},[r]);const m=()=>{d(!0)},t=()=>{d(!1),a(null)},c=()=>{l(!0)},k=()=>{l(!1),a(null)},s=()=>{C(!0)},i=()=>{C(!1),a(null)},h=()=>{D.get("/users/get-users").then(u=>{u.status==200&&o(u.data)})},x=u=>{a(u),m()},B=u=>{ge().then(R=>{R.isConfirmed&&D.delete(`users/remove-user/${u}`).then(P=>{P.status==200&&w(P.data).then(()=>{h()})})})},F=u=>{a(u),c()},N=u=>{a(u),s()};return b(U,{display:"flex",flexDirection:"column",p:2,children:[e($,{variant:"h5",children:"ผู้ใช้งาน"}),e(be,{}),e(U,{pt:1.5,children:e(S,{variant:"contained",color:"success",onClick:m,children:"เพิ่มผู้ใช้งาน"})}),e(U,{width:"100%",maxWidth:"100wh",height:"70vh",mt:3,children:n&&e(De,{rows:n,columns:y,getRowId:u=>u.user_id,components:{Toolbar:Se},showCellVerticalBorder:!0,showColumnVerticalBorder:!0,sx:{width:"100%"}})}),r&&e(Ve,{open:r,handleDialogClose:t,userId:_}),g&&e(qe,{open:g,handleDialogClose:k,userId:_}),p&&e(Le,{open:p,handleDialogClose:i,userId:_})]})}export{Ye as default};
